{# js ListForm #}

{% extends '_global/js.html.twig' %}

{% block js %}

    {{ parent() }}   
    <script>
        $('#Descripcion0').focus();

        $('#IdFirma').change(function(){
            $('#espereFamilias').removeClass('hidden');            
            putFamilias(this.value,'IdFamilia');
            $('#espereFamilias').addClass('hidden');             
            $('#divFamilias').removeClass('hidden');             
        });
        
        $('#IdFamilia').change(function(){

            $.ajax({
                url: appPath + '/lib/getPromociones.php?idFirma=' + $('#IdFirma').val() + '&idFamilia=' + this.value,
                dataType: 'html',
                type: 'get',
                success: function (resultado) {
                    var datos = $.parseJSON(resultado);
                    $.each(datos, function (key, value) {
                        $('#promociones').append(value.Id+" "+value.IdArticulo+" "+value.FechaLimite+"<br/>");
                    });
                }
            }); 
            $('#listado').removeClass('hidden');            
        });
        
        function guardar(keyLinea) {
            if (valida(keyLinea)) {
                espere(keyLinea);
                $('#action' + keyLinea).val('editForm');
                $('#accion' + keyLinea).val('G');
                $('#formLinea' + keyLinea).submit();
            } else {
                return false;
            }
        }

        function borrar(keyLinea) {
            if (valida(keyLinea)) {
                espere(keyLinea);
                $('#action' + keyLinea).val('editForm');
                $('#accion' + keyLinea).val('B');
                $('#formLinea' + keyLinea).submit();
            } else {
                return false;
            }
        }

        function crear(keyLinea) {
            if (valida(keyLinea)) {
                espere(keyLinea);
                $('#action' + keyLinea).val('newForm');
                $('#formLinea' + keyLinea).submit();
            } else {
                alert("Debe indicar la descripción de la familia");
                return false;
            }
        }

        function valida(keyLinea) {
            ok = true;
            if ($('#Descripcion' + keyLinea).val() === '') {
                ok = false;
                mensaje = "Debe indicar la descripción de la familia";
            }
            return ok;
        }

        function espere(keyLinea) {
            $('#botonera' + keyLinea).hide();
            $('#espere' + keyLinea).removeClass('hidden');
        }

    </script>
{% endblock %}