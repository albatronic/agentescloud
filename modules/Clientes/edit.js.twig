{# js Clientes #}

{% extends '_global/js.html.twig' %}

{% block js %}

    {{ parent() }}
    <script src="{{app.path}}/assets/highcharts/js/highcharts.js"></script>
    <script src="{{app.path}}/assets/highcharts/js/highcharts-3d.js"></script>
    <script src="{{app.path}}/assets/highcharts/js/modules/exporting.js"></script>    
    <script>
        function ajaxHistoricoVentas(idArticulo, idCliente, periodo) {

            if (idArticulo === '') {
                idArticulo = '0';
            }

            $.ajax({
                url: appPath + '/apiRest/HistoricoVentas/' + idArticulo + '/' + idCliente + '/' + periodo + '/html',
                dataType: 'html',
                type: 'get',
                success: function (html) {
                    $("#dialogHistoricoVentas .modal-body").html(html);
                }
            });
        }

        function cargaDireccionesEntrega(idDiv) {

            $('#' + idDiv).html("<iframe width='100%' height='380' scrolling='yes' style='border: 0px dotted grey;' src='{{app.path}}/ClientesDEntrega/list/{{datos.IdCliente}}'></iframe>");

        }

        function cargaContactos(idDiv) {

            $('#' + idDiv).html("<iframe width='100%' height='380' scrolling='yes' style='border: 0px dotted grey;' src='{{app.path}}/ClientesContactos/list/{{datos.IdCliente}}'></iframe>");

        }

        function cargaCondicionesComerciales(idDiv) {

            $('#' + idDiv).html("<iframe width='100%' height='380' scrolling='yes' style='border: 0px dotted grey;' src='{{app.path}}/Clientes/listVencimientos/{{datos.IdCliente}}'></iframe>");

        }

        function cargaGraficoVentas(idCliente, periodo, idDiv) {
            $.ajax({
                url: appPath + '/lib/graph.php',
                dataType: 'html',
                type: 'get',
                data: {'accion': 'cliente', 'idCliente': idCliente, 'periodo': periodo},
                success: function (resultado) {
                    var datos = [];
                    result = $.parseJSON(resultado);
                    $.each(result.serie, function (key, item) {
                        datos.push({name: item.name, y: parseFloat(item.y)});
                    });

                    var opciones = {
                        chart: {
                            type: 'column',
                        },
                        title: {
                            text: result.title
                        },
                        xAxis: {
                            type: 'category'
                        },
                        yAxis: {
                            title: {
                                text: 'Total Ventas (BI)'
                            }
                        },
                        legend: {
                            enabled: false
                        },
                        tooltip: {
                            //pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            series: {
                                borderWidth: 0,
                                dataLabels: {
                                    enabled: true,
                                    format: '{point.y:.0f} â‚¬'
                                }
                            }
                        },
                        series: [{
                                type: 'column',
                                name: result.serieName,
                                data: datos
                            }]
                    };
                    $('#'+idDiv).highcharts(opciones);
                }
            });            
        }

        function cargaGraficoVentasPorFirmas(idCliente, periodo, idDiv) {
            $.ajax({
                url: appPath + '/lib/graph.php',
                dataType: 'html',
                type: 'get',
                data: {'accion': 'clienteFirmas', 'idCliente': idCliente, 'periodo': periodo},
                success: function (resultado) {
                    var datos = [];
                    result = $.parseJSON(resultado);
                    $.each(result.serie, function (key, item) {
                        datos.push({name: item.name, y: parseFloat(item.y)});
                    });

                    var opciones = {
                        chart: {
                            type: 'pie',
                        },
                        title: {
                            text: result.title
                        },
                        xAxis: {
                            type: 'category'
                        },
                        yAxis: {
                            title: {
                                text: 'Total Ventas (BI)'
                            }
                        },
                        legend: {
                            enabled: false
                        },
                        tooltip: {
                            //pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                depth: 35,
                                dataLabels: {
                                    enabled: true,
                                    format: '{point.name}'
                                }
                            }
                        },
                        series: [{
                                type: 'pie',
                                name: result.serieName,
                                data: datos
                            }]
                    };
                    $('#'+idDiv).highcharts(opciones);
                }
            });            
        }

        $("#docs").click(function () {
            url = "<iframe src='{{app.path}}/CpanDocs/listPopup/{{values.controller}}/{{datos.PrimaryKeyValue}}/document/1' width='100%' height='270' scrolling='yes' style='border: 0px dotted grey;'></iframe>";
            $("#divDocs").html(url);
        });

        function limpia(idOrigen, idInput) {

            if ($('#' + idOrigen + '_valorAnterior').val() !== $('#' + idOrigen).val()) {
                $('#' + idInput).val('');
                $('#' + idInput + '_autoComplete').val('');
            }

        }
    </script>
{% endblock %}